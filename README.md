# Автоматизация выгрузки и загрузки чеков торговой сети

## Описание проекта

Этот проект автоматизирует процесс сбора и загрузки данных о продажах для крупной торговой сети товаров для дома (бытовая химия, текстиль, посуда и др.).  
Каждый день из кассовых программ генерируются выгрузки по чекам, которые затем загружаются в единую базу данных PostgreSQL для аналитики.

---

## Состав проекта

- **config.ini** — все параметры генерации, список категорий, диапазоны цен, параметры подключения к БД.
- **sales_data.py** — генератор тестовых выгрузок чеков (.csv).
- **run.py** — основной скрипт: запускает генерацию выгрузок и загружает их в базу данных.
- **pgdb.py** — модуль для работы с PostgreSQL.
- **sql/create_tables.sql** — SQL-скрипт создания таблицы sales.
- **requirements.txt** — список зависимостей Python.
- **.gitignore** — список файлов/папок, которые не попадают в git.
- **data/** — папка для выгрузок чеков (каждый .csv — выгрузка одной кассы).
- **img/** — скриншоты автоматизации (cron/планировщик) и структуры таблицы БД.
- **logs/** — лог-файлы.
- **example.csv** — пример выгрузки для проверки формата.
- **README.md** — эта инструкция.

---

## Быстрый старт

### 1. Клонирование и установка зависимостей

```bash
git clone <ССЫЛКА_НА_РЕПОЗИТОРИЙ>
cd <ИМЯ_ПРОЕКТА>
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

### 2. Настройка базы данных
Создайте PostgreSQL-базу (например, my_db).
Выполните SQL из sql/create_tables.sql:

CREATE TABLE IF NOT EXISTS sales (
    doc_id VARCHAR(32) NOT NULL,
    item VARCHAR(255) NOT NULL,
    category VARCHAR(100),
    amount INT,
    price INT,
    discount INT,
    PRIMARY KEY (doc_id, item)
);

### 3.В файле config.ini укажите host/port.
### 4.Установите переменные окружения для пользователя и пароля:

## Генерация и загрузка данных
### Скрипт удалит старые файлы из data/, сгенерирует новые и загрузит их в БД.


##Проверка

###Откройте БД через pgAdmin/DBeaver и выполните:
SELECT * FROM sales LIMIT 10;
###В корне репозитория есть файл example.csv — это пример структуры выгрузки.

#Автоматизация (по условиям задачи)

Linux/Mac (через cron)
редактор crontab:
crontab -e
Добавьте строку для автоматического запуска (каждый день, кроме воскресенья):
0 8 * * 1-6 cd /путь/к/проекту && /путь/к/venv/bin/python run.py
Скриншот задания положите в img/cron_example.png.
Windows (Планировщик заданий)
Откройте “Планировщик заданий” Windows.
Настройте задачу на ежедневный запуск run.py, кроме воскресенья.
Скриншот с настройкой добавьте в img/windows_task.png.
Основные функции и архитектурные решения

Генерация выгрузок — создаются отдельные .csv-файлы для каждой кассы каждого магазина; имена файлов в формате shopnum_cashnum.csv.
Уникальность чеков — у каждого doc_id формат shopnum_cashnum_номер, что гарантирует уникальность по всей сети.
Лишние файлы в папке data/ игнорируются — загружаются только .csv.
Удаление старых выгрузок — при каждом запуске генератора все старые csv-файлы из data/ удаляются автоматически.
Гибкая настройка объёма данных — через config.ini можно уменьшить количество магазинов, касс и строк.
Обработка ошибок — при ошибках генерации или загрузки в БД скрипт выводит сообщение в консоль (можно расширить логирование в файл).
Лёгкость масштабирования — новые категории товаров и диапазоны цен легко добавляются через config.ini.
Папка logs/ — предназначена для хранения лог-файлов (опционально).  
